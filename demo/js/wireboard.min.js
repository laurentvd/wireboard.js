Wireboard.extend=function(a,b){var c=function(a){return a&&_.has(a,"constructor")},d=function(a){return c(a)?a.constructor:function(){return e.apply(this,arguments)}},e=this;a=a||{};var f=d(a);_.assign(f,e,b);var g=function(){this.constructor=f};g.prototype=e.prototype,f.prototype=new g;var h=f;return _.assign(h.prototype,a),h.prototype.__parent||(h.prototype.__parent=e.prototype),h.prototype.__static=_.assign({},e,b),h},Wireboard.Event=function(){var a=function(){this.initialize.apply(this,arguments)};return a.extend=Wireboard.extend,a.prototype={_type:"",_target:null,initialize:function(a,b){if(this._type=b||this.__static.TYPE,_.extend(this,a),!this.getType())throw new Error("Cannot create an Event without passing it an event type.")},getType:function(){return this._type},getTarget:function(){return this.target},toString:function(){return"[object Event]"}},a}(),Wireboard.EventDispatcher=function(){"strict mode";var a=function(){this.initialize.apply(this,arguments)};return a.extend=Wireboard.extend,a.prototype={eventListeners:null,globalListeners:null,log:!1,initialize:function(){this.eventListeners={},this.globalListeners=[]},addEventListener:function(a,b){var c=this.eventListeners;void 0===c[a]&&(c[a]=[]),-1===_.indexOf(c[a],b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this.eventListeners)return!1;var c=this.eventListeners;return void 0!==c[a]&&-1!==_.indexOf(c[a],b)?!0:!1},removeEventListener:function(a,b){if(void 0!==this.eventListeners){var c=this.eventListeners,d=c[a];if(void 0!==d){var e=_.indexOf(d,b);-1!==e&&d.splice(e,1)}}},dispatchEvent:function(a){if(this.log&&this._logEvent(a),void 0!==this.eventListeners){var b=this.eventListeners,c=b[a.getType()];if(void 0!==c){a._target=this;for(var d=[],e=c.length,f=0;e>f;f++)d[f]=c[f];for(f=0;e>f;f++){if("undefined"==typeof d[f].call)throw new Error("Event handler function undefined or not a function for event "+a.getType());d[f].call(this,a)}var g=this.globalListeners.length;for(f=0;g>f;f++)this.globalListeners[f].call(this,a)}}},addGlobalListener:function(a){this.globalListeners.push(a)},removeGlobalListener:function(a){this.globalListeners=_.without(this.globalListeners,a)},_logEvent:function(a){var b=new Date,c=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+"."+b.getMilliseconds();console.log("["+c+"] "+a.getType())},toString:function(){return"[object EventDispatcher]"}},a}(),Wireboard.Command=function(){var a=function(){this.initialize.apply(this,arguments)};return a.prototype={dispatcher:"inject",event:null,context:"inject",initialize:function(a){this.event=a},execute:function(){throw new Error("Command should override the execute method.")},dispatch:function(a){this.dispatcher.dispatchEvent(a)},toString:function(){return"[object Command]"}},a}(),Wireboard.CommandMap=function(a){"use strict";var b=function(){this.initialize.apply(this,arguments)};return b.prototype={mappings:{},dispatcher:"inject",context:"inject",injector:null,initialize:function(a){this.injector=a,this.injector.injectInto(this),this.dispatcher.addGlobalListener(_.bind(this._onEvent,this))},map:function(b,c){return this.mappings[b]===a&&(this.mappings[b]=[]),this.mappings[b].push(c),this},_onEvent:function(b){var c=b.getType();if(this.mappings[c]!==a){var d=this;_.each(this.mappings[c],function(a){d._executeCommand(a,b)})}},_executeCommand:function(a,b){var c=new a(b);this.injector.injectInto(c),c.execute()},toString:function(){return"[object CommandMap]"}},b}(),Wireboard.View=function(){var a=function(a){a=a||{},a.injector?a.injector.injectInto(this):Wireboard.instances.injector&&Wireboard.instances.injector.injectInto(this),a.el&&this.setEl(a.el),Wireboard.EventDispatcher.prototype.initialize.apply(this),this.initialize.apply(this,arguments)};return a.extend=Wireboard.extend,a.prototype=_.extend({dispatcher:"inject",el:null,$el:null,initialize:function(){},template:function(a,b){var c=Wireboard.Views.Templates["./assets/templates/"+a+".html"];if(!c)throw"Could not load template "+a;return c(b)},setEl:function(a){return this.el=a,this.$el=$(a),this},toString:function(){return"[object View]"}},Wireboard.EventDispatcher.prototype),a}(),Wireboard.ViewMap=function(){var a=function(){this.initialize.apply(this,arguments)};return a.prototype={mappings:[],dispatcher:"inject",context:"inject",injector:"inject",initialize:function(a){a.injectInto(this)},map:function(a,b,c){if(!b)throw new Error("The supplied view for selector "+a+" is undefined.");var d=new Wireboard.ViewMapping(a,b,c);return this.injector.injectInto(d),this.mappings.push(d),d},build:function(){return _.invoke(this.mappings,"build"),this},destroy:function(){return _.invoke(this.mappings,"destroy"),this},getMappings:function(){return this.mappings},toString:function(){return"[object ViewMap]"}},a}(),Wireboard.ViewMapping=function(){var a=function(){this.initialize.apply(this,arguments)};return a.prototype={injector:"inject",viewInjector:null,selector:"",builtElements:[],ViewClass:null,ViewMediatorClass:null,views:[],mediators:[],initialize:function(a,b,c){this.selector=a,this.ViewClass=b,this.ViewMediatorClass=c},inject:function(a,b){return this.viewInjector||(this.viewInjector=this.injector.createChildInjector()),this.viewInjector.map(a).toValue(b),this},build:function(){var a=$(this.selector);if(!a.length)return this;var b=this.builtElements,c=this,d=function(a,d){_.contains(b,d)||(b.push(d),c._createView(d))};return a.each(d),this},destroy:function(){var a=this,b=function(b){a._destroyView(b)};return _.each(this.views,b),this.views=[],this},_createView:function(a){var b=new this.ViewClass({el:a,injector:this.injector});if(this.views.push(b),this.ViewMediatorClass){var c=new this.ViewMediatorClass(b);this.injector.injectInto(c),c.register(),this.mediators.push(c)}},_destroyView:function(a){return a.destroy?void a.destroy():void(a.el.parentNode&&a.el.parentNode.removeChild(a.el))},toString:function(){return"[object ViewMapping]"}},a}(),Wireboard.ViewMediator=function(){var a=function(){this.initialize.apply(this,arguments)};return a.extend=Wireboard.extend,a.prototype={view:"inject",dispatcher:"inject",context:"inject",initialize:function(a){this.view=a},addEventListener:function(a,b){this.dispatcher.addEventListener(a,b)},removeEventListener:function(a,b){this.dispatcher.removeEventListener(a,b)},register:function(){throw new Error("Register function not defined on ViewMediator "+this)},toString:function(){return"[object ViewMediator]"}},a}(),Wireboard.Context=function(){var a=function(){this.initialize.apply(this,arguments)};return a.GLOBAL_INJECTOR=!0,a.extend=Wireboard.extend,a.prototype={dispatcher:null,injector:null,views:null,commands:null,initialize:function(){this._constructDependencies(),this.startup()},startup:function(){},start:function(){return this.views.build(),this},destroy:function(){return this.views.destroy(),this},_constructDependencies:function(){this.dispatcher=new Wireboard.EventDispatcher,this.injector=this._getInjector(),this.views=new Wireboard.ViewMap(this.injector),this.commands=new Wireboard.CommandMap(this.injector)},_getInjector:function(){if(Wireboard.instances.injector)return Wireboard.instances.injector;var b=new window.injector.Injector;return b.map("dispatcher").toValue(this.dispatcher),b.map("context").toValue(this),a.GLOBAL_INJECTOR&&(Wireboard.instances.injector=b),b},toString:function(){return"[object Context]"}},a}();